# ---------------------------
# Authentik 2025.8.4 values
# ---------------------------

postgresql:
  enabled: true
  auth:
    existingSecret: authentik-env
    secretKeys:
      userKey: POSTGRES_USER
      passwordKey: password
      databaseKey: POSTGRES_DB
  primary:
    persistence:
      enabled: true
      size: 10Gi
    resources:
      requests:
        cpu: 250m
        memory: 512Mi

redis:
  enabled: true
  architecture: standalone
  auth:
    existingSecret: authentik-env
    existingSecretPasswordKey: redis-password   # <-- see step 3 below
  master:
    persistence:
      enabled: true
      size: 2Gi
    resources:
      requests:
        cpu: 100m
        memory: 256Mi

server:
  envFrom:
    - secretRef:
        name: authentik-env
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-dns
      nginx.ingress.kubernetes.io/rewrite-target: /
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      nginx.ingress.kubernetes.io/configuration-snippet: |
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Port 443;
        proxy_set_header X-Real-IP $remote_addr;
    hosts:
      - host: auth.white.fm
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: auth-white-fm-tls
        hosts:
          - auth.white.fm
          - auth.whitematter.tech
          - auth.w3rdw.radio
  replicaCount: 2
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
  volumeMounts:
    - name: media
      mountPath: /media
  volumes:
    - name: media
      persistentVolumeClaim:
        claimName: authentik-media
  service:
    port: 9000
    type: ClusterIP

worker:
  envFrom:
    - secretRef:
        name: authentik-env
  replicaCount: 2
  resources:
    requests:
      cpu: 150m
      memory: 256Mi

persistence:
  enabled: true
  accessModes: [ReadWriteOnce]
  size: 5Gi
  storageClass: longhorn

podSecurityContext:
  fsGroup: 1000
securityContext:
  runAsUser: 1000
  runAsGroup: 1000
