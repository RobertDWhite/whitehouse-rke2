# ===========================
# Authentik
# ===========================

authentik:
  enabled: true
  existingSecret:
    secretName: authentik-env

# ---------------------------
# PostgreSQL
# ---------------------------
postgresql:
  enabled: true

  auth:
    existingSecret: authentik-env
    secretKeys:
      userKey: POSTGRES_USER
      passwordKey: password
      databaseKey: POSTGRES_DB

  primary:
    persistence:
      enabled: true
      storageClass: longhorn
      size: 10Gi

    resources:
      requests:
        cpu: 1000m
        memory: 2Gi

# ---------------------------
# Redis
# ---------------------------
redis:
  enabled: true
  architecture: standalone

  auth:
    existingSecret: authentik-env
    existingSecretPasswordKey: redis-password

  master:
    persistence:
      enabled: true
      storageClass: longhorn
      size: 5Gi

    resources:
      requests:
        cpu: 500m
        memory: 512Mi

# ---------------------------
# Authentik Server
# ---------------------------
server:
  enabled: true
  replicas: 2

  envFrom:
    - secretRef:
        name: authentik-env

  resources:
    requests:
      cpu: 1000m
      memory: 1Gi

  persistence:
    enabled: true
    storageClass: longhorn
    size: 5Gi

  containerPorts:
    https: 9443

  service:
    type: ClusterIP
    servicePortHttps: 443
    servicePortHttpsName: https

  ingress:
    enabled: true
    ingressClassName: nginx
    https: true

    annotations:
      nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
      cert-manager.io/cluster-issuer: letsencrypt-dns

    hosts:
      - auth.white.fm

    paths:
      - /

    tls:
      - secretName: auth-white-fm-tls
        hosts:
          - auth.white.fm
          - auth.whitematter.tech
          - auth.w3rdw.radio

# ---------------------------
# Authentik Worker
# ---------------------------
worker:
  enabled: true
  replicas: 2

  envFrom:
    - secretRef:
        name: authentik-env

  resources:
    requests:
      cpu: 500m
      memory: 1Gi

# ---------------------------
# Security Contexts
# ---------------------------
podSecurityContext:
  fsGroup: 1000

securityContext:
  runAsUser: 1000
  runAsGroup: 1000