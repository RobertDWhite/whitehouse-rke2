apiVersion: v1
kind: ConfigMap
metadata:
  name: promtail-config
  namespace: observability
data:
  promtail.yaml: |
    server:
      http_listen_port: 9080
      grpc_listen_port: 0

    positions:
      filename: /tmp/positions.yaml

    clients:
      - url: http://loki:3100/loki/api/v1/push

    scrape_configs:
      - job_name: syslog
        syslog:
          listen_address: 0.0.0.0:1514
          idle_timeout: 60s
          label_structured_data: true
          labels:
            job: syslog

        pipeline_stages:
          - regex:
              source: __syslog_message_proc_id
              expression: '^(?P<app>[a-zA-Z0-9._-]+)'
          - labels:
              app:
          - labels:
              host: __syslog_message_hostname